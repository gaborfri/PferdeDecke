<!doctype html>
<html lang="de">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <meta name="theme-color" content="#0b5fff" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <link rel="manifest" href="./manifest.json" />
    <!-- App Icons -->
    <!-- iOS nutzt bevorzugt 180x180 -->
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon-180.png" />
    <!-- Zusätzliche Größen (optional) -->
    <link rel="apple-touch-icon" sizes="192x192" href="icons/icon-192.png" />
    <link rel="apple-touch-icon" sizes="512x512" href="icons/icon-512.png" />
    <!-- Favicon / Android Launcher -->
    <link rel="icon" href="icons/icon-192.png" />
    <meta name="apple-mobile-web-app-title" content="Pferdedecke" />
    <title>Pferdedecke</title>
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <div id="ptr" aria-hidden="true"><div class="ptr-inner"><div class="ptr-spinner hidden"></div><div class="ptr-label">Zum Aktualisieren ziehen</div></div></div>
    <div class="fab-cluster">
      <img src="icons/icon-192.png" alt="Pferdedecke" class="fab-logo" aria-hidden="true" />
      <button id="btn-menu" class="fab" aria-label="Menü" title="Menü"><span aria-hidden="true">☰</span></button>
    </div>

    <main>
      

      <section id="tomorrow" class="card hidden">
        <h3>Morgen</h3>
        <div id="tomorrow-forecast"></div>
      </section>

      <section id="today" class="card hidden">
        <h3>Heute</h3>
        <div id="today-forecast"></div>
        <div style="margin-top:8px">
          <label for="fb-chip-scroll" class="sr-only">Klicke oder tippe auf die gewünschte Kategorie, die Empfehlung ist markiert.</label>
          <div class="row feedback-row">
            <div id="fb-chip-scroll" class="chip-scroll" role="listbox" aria-label="Kategorien – Tippen, um Feedback zu geben" title="Tippe auf die passende Kategorie; die Empfehlung ist markiert." tabindex="0"></div>
          </div>
        </div>
      </section>

    </main>
    <div id="menu-overlay" class="overlay hidden menu-overlay" role="dialog" aria-modal="true" aria-label="App-Menü">
      <div class="menu-container">
        <button id="btn-menu-close" class="menu-close" aria-label="Schließen">×</button>
        <img src="icons/icon-192.png" alt="Pferdedecke" class="menu-logo" />
        <div class="menu-actions" role="menu">
          <button id="menu-settings" role="menuitem">Einstellungen</button>
          <button id="menu-export" role="menuitem">Backup exportieren</button>
          <button id="menu-import" role="menuitem">Backup importieren…</button>
          <button id="menu-feedback-log" role="menuitem">Feedback-Verlauf</button>
          <button id="menu-info" role="menuitem">Info</button>
        </div>
      </div>
    </div>

    <!-- Einstellungen Overlay -->
    <div id="settings" class="overlay hidden" role="dialog" aria-modal="true" aria-labelledby="settings-title">
      <div class="panel">
        <div class="panel-header">
          <h2 id="settings-title">Einstellungen</h2>
          <button id="btn-settings-close" class="icon" aria-label="Schließen">×</button>
        </div>
        <div class="panel-content">
          <section class="card">
            <h3>Allgemein</h3>
            <div class="row" style="align-items: center; gap: 10px; flex-wrap: wrap;">
              <label class="toggle">Zeitpunkt
                <select id="time-mode">
                  <option value="day">Tag</option>
                  <option value="night">Nacht</option>
                </select>
              </label>
            </div>
          </section>
          <section id="location" class="card">
            <h3>Standort</h3>
            <div class="row" style="align-items:center; flex-wrap: wrap; gap: 10px;">
              <label class="toggle">Quelle
                <select id="loc-mode">
                  <option value="auto">Automatisch (GPS)</option>
                  <option value="manual">Manuell</option>
                </select>
              </label>
              <div id="manual-loc" class="row hidden" style="gap:8px; flex-wrap: wrap;">
                <input id="loc-name" type="text" placeholder="Ortsname (optional)" style="min-width: 200px;" />
                <input id="loc-lat" type="number" step="0.000001" placeholder="Breite (Lat)" style="width: 160px;" />
                <input id="loc-lon" type="number" step="0.000001" placeholder="Länge (Lon)" style="width: 160px;" />
                <button id="loc-save">Speichern</button>
                <input id="loc-url" type="text" placeholder="Karten-Link einfügen (Apple/Google/OSM/geo:)" style="min-width: 320px; flex: 1 1 320px;" />
                <button id="loc-parse" title="Koordinaten aus Link übernehmen">Aus Link übernehmen</button>
                <button id="loc-open" title="In Karten öffnen">In Karten öffnen</button>
              </div>
            </div>
            <small class="muted">Hinweis: Für einen festen Ort (z. B. „Gut Warxbüttel“) den Modus „Manuell“ wählen und Koordinaten eintragen.</small>
          </section>

          <section id="config" class="card">
            <h3>Kategorien</h3>
            <p class="muted">Beliebige Anzahl; Wärmegrad: niedriger = leichter.</p>
            <div id="items"></div>
            <div class="row" style="margin-top:8px">
              <button id="add-item">+ Kategorie</button>
              <button id="reset-items" title="Standard wiederherstellen">Zurücksetzen</button>
            </div>
          </section>
        </div>
      </div>
    </div>

    <div id="feedback-log" class="overlay hidden" role="dialog" aria-modal="true" aria-labelledby="feedback-log-title">
      <div class="panel" style="max-width: 720px">
        <div class="panel-header">
          <h2 id="feedback-log-title">Feedback-Verlauf</h2>
          <button id="btn-feedback-log-close" class="icon" aria-label="Schließen">×</button>
        </div>
        <div class="panel-content">
          <p class="muted">Zeigt die gespeicherten Feedback-Tage (neueste zuerst). Daten bleiben nur lokal auf diesem Gerät.</p>
          <div id="feedback-log-list" class="feedback-log-list"></div>
        </div>
      </div>
    </div>

    <!-- Info Overlay -->
    <div id="info" class="overlay hidden" role="dialog" aria-modal="true" aria-labelledby="info-title">
      <div class="panel" style="max-width: 720px">
        <div class="panel-header">
          <h2 id="info-title">Info</h2>
          <button id="btn-info-close" class="icon" aria-label="Schließen">×</button>
        </div>
        <div class="panel-content">
          <section class="card">
            <h3>Über diese App</h3>
            <p>Die App empfiehlt eine passende Pferdedecke anhand der lokalen Wettervorhersage und lernt aus deinem täglichen Feedback. Die Berechnung erfolgt lokal im Browser (On‑Device‑ML mit TensorFlow.js); Daten bleiben auf deinem Gerät.</p>
            <p class="muted">Wetterdaten: Open‑Meteo · Offline nach dem ersten Laden nutzbar.</p>
          </section>
        </div>
      </div>
    </div>

    <!-- iOS Install-Hinweis Overlay -->
    <div id="install-hint" class="overlay hidden" role="dialog" aria-modal="true" aria-labelledby="install-title">
      <div class="panel" style="max-width: 560px">
        <div class="panel-header">
          <h2 id="install-title">Als App installieren</h2>
          <button id="btn-install-close" class="icon" aria-label="Schließen">×</button>
        </div>
        <div class="panel-content">
          <section class="card">
            <p>Auf dem iPhone (Safari): Teilen antippen und „Zum Home‑Bildschirm“ wählen, um die PWA zu installieren.</p>
            <div class="row" style="justify-content: flex-end; margin-top: 8px">
              <button id="install-ok">Verstanden</button>
            </div>
          </section>
        </div>
      </div>
    </div>

    <!-- Update Prompt Overlay -->
    <div id="update-prompt" class="overlay hidden" role="dialog" aria-modal="true" aria-labelledby="update-title">
      <div class="panel" style="max-width: 520px">
        <div class="panel-header">
          <h2 id="update-title">Neue Version verfügbar</h2>
          <button id="btn-update-close" class="icon" aria-label="Schließen">×</button>
        </div>
        <div class="panel-content">
          <section class="card">
            <p>Es ist eine neue App-Version verfügbar. Jetzt aktualisieren?</p>
            <div class="row">
              <button id="update-now">Aktualisieren</button>
              <button id="update-later" class="secondary">Später</button>
            </div>
          </section>
        </div>
      </div>
    </div>

    <script src="./vendor/tf.min.js"></script>
    <script type="module" src="./app.js"></script>
    <script>
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker.register("./sw.js").catch(console.error);
      }
    </script>
  </body>
  <!-- Toast container -->
  <div id="toaster" class="toaster" aria-live="polite" aria-atomic="true"></div>
  <!-- Monatliches Backup-Prompt -->
  <div id="backup-prompt" class="overlay hidden" role="dialog" aria-modal="true" aria-labelledby="backup-title">
    <div class="panel" style="max-width: 520px">
      <div class="panel-header">
        <h2 id="backup-title">Monatliches Backup</h2>
        <button id="btn-backup-close" class="icon" aria-label="Schließen">×</button>
      </div>
      <div class="panel-content">
        <section class="card">
          <p>Es ist Zeit für ein monatliches Backup. Möchtest du jetzt ein Backup exportieren?</p>
          <div class="row">
            <button id="backup-now">Jetzt exportieren</button>
            <button id="backup-later" class="secondary">Später</button>
          </div>
        </section>
      </div>
    </div>
  </div>
  </html>
